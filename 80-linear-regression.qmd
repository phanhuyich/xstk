# Hồi quy

Hồi quy là phương pháp tìm quan hệ giữa
nhập liệu và kết quả:

- $X$: nhập liệu (input, features, explanatory variables, covariates, independent variables)
- $Y$: kết quả (output, response, explained variable, dependent variable)

Giả sử
cặp biến
$(X, Y) \sim \P_{X,Y}$
có mật độ xác suất $f(x,y),$
mật độ xác suất biên $f(x)$ và
mật độ xác suất có điều kiện $f(y|x).$

:::{#def-regression}
### Regression function
Hàm hồi quy là kỳ vọng về $Y$
khi biết $X:$
$$
x\mapsto r(x) \is \E{Y|X=x} = \int y f(y|x) dy
.$$
:::

:::{#def-conditional-quantile}
### Conditional quantile
Cho $\alpha\in[0,1],$
phân vị $q_{\alpha}$ cho $Y$
khi biết $X=x:$
$$
x\mapsto q_{\alpha}(x) \textrm{ such that }
\int_{-\infty}^{q_{\alpha}(x)} f(y|x) dy \equiv 1-\alpha
.$$
Đặt $\alpha=1/2$ ta có conditional median.
:::

## Hồi quy tuyến tính
:::{#def-linear-regression}
### Theoretical linear regression
Đường
hồi quy tuyến tính áp $Y\in\R$ lên $X\in\R$ là
$\hat{y} = r(x) = \beta_0 + \beta_1 x$
với hệ số (intercept và slope) là
$$
(\beta_0, \beta_1) \is
\argmin_{(a,b)\in\R^2} \E{(Y-a-b X)^2}.
$$
:::

:::{#def-regression-noise}
### Noise
Nhiễu
$\epsilon\is Y-(\beta_0+\beta_1 X).$
:::

:::{#thm-linear-regression}
Giả sử $\V{X}>0,$ ta có:
$$
\begin{split}
\beta_0 &= \E{Y} - \beta_1\E{X},\\
\beta_1 &= \frac{\Cov{X,Y}}{\V{X}},\\
\E{\epsilon}&= 0, \Cov{X,\epsilon} = 0.
\end{split}
$$
:::

## Hồi quy đa biến
:::{#def-multivariate-linear-regression}
### Multivariate regression
Giả sử biến $\X\in\R^p, Y\in\R,$
tọa độ đầu tiên của $\X$ là 1,
mô hình hồi quy tuyến tính
với tham số $\vec{\beta}^*\in\R^p$ là
$$
Y = \X^\tp\vec{\beta}^* + \epsilon,
$$
với
$$
\vec{\beta}^* \is
\argmin_{\vec{\beta}\in\R^p} \E{(Y-\X^\tp\vec{\beta})^2},
$$
và nhiễu $\epsilon$ thỏa mãn
$\E{\epsilon}= 0, \Cov{\X,\epsilon} = \vec{0}.$
:::

## LSE đơn biến
:::{#def-least-squares-estimator}
### Least squares estimator, LSE
Quan sát trên $\R\times\R$ các cặp biến thực
$(X_i, Y_i)_{i=1,\ldots,n}\iid \P_{(X,Y)}.$
LSE là điểm cực tiểu của
tổng bình phương độ lệch (residual sums of squares):
$$
\begin{split}
(\hat{a}, \hat{b}) &\is
\argmin_{(\beta_0,\beta_1)\in\R^2} \sum_{i=1}^{n}\epsilon_i^2,\\
\epsilon_i&\is {(Y_i-\beta_0 X_i-\beta_1)}\quad i=1,\ldots,n.
\end{split}
$$
:::
:::{#thm-lse-solution}
### LSE solution
$$
\begin{split}
\hat{a} &= \frac{\overline{XY}-\bar{X}\bar{Y}}{\overline{X^2}-\bar{X}^2},\\
\hat{b} &= \bar{Y} - \hat{a}\bar{X}.
\end{split}
$$
:::

## LSE đa biến
:::{#def-lse-multivars}
### Least squares estimator, LSE in matrix form
Quan sát i.i.d
$\X_i\in\R^p, Y_i\in\R, i=1,\ldots,n.$
Giả sử tọa độ đầu tiên của các $\X_{i}$ đều là 1.
Nhiễu là
$$
\epsilon_i = Y_i - \X_i^\tp\vec{\beta}, i=1,\ldots,n,
$$
thỏa mãn
$\E{\epsilon_i}= 0, \Cov{\X_i,\epsilon_i} = \vec{0},$

Đặt

$$
\begin{split}
\XX \is&
\begin{pmatrix}
\X_1^\tp\\
\vdots\\
\X_n^\tp\\
\end{pmatrix}
\in\R^{n\times p},\,
\vec{\epsilon} \is (\epsilon_1,\ldots,\epsilon_n)^\tp\in\R^n,\\
&\vec{Y} \is\begin{pmatrix}
Y_1\\
\vdots\\
Y_n\\
\end{pmatrix}
=
\begin{pmatrix}
\X_1^\tp\\
\vdots\\
\X_n^\tp\\
\end{pmatrix}
\vec{\beta} + \vec{\epsilon}
=
\XX\vec{\beta} + \vec{\epsilon}
.
\\
\end{split}
$$

Gọi $\XX$ là **design matrix**.
Ta ước lượng $\vec{\beta}^*$ bởi
$$
\begin{split}
\textrm{LSE}\quad \hat{\vec{\beta}} &\is
\argmin_{\vec{\beta}\in\R^p} \|\vec{Y} - \XX \vec{\beta}\|_2^2.
\end{split}
$$
:::

:::{#thm-score-equation}
### Score equation
$$
(\XX^\tp\XX)\hat{\vec{\beta}} \equiv \XX^\tp\vec{Y}.
$$
Nếu $\XX$ full rank thì
$\hat{\vec{\beta}} \equiv (\XX^\tp\XX)^{-1}\XX^\tp\vec{Y}.$
:::

:::{.remark}
Đặt $P\is \XX(\XX^\tp\XX)^{-1}\XX^\tp$ ta có
$\hat{\vec{Y}}\is\XX\hat{\vec{\beta}} = P\vec{Y} \equiv P^2\vec{Y}$
là xạ ảnh của $\vec{Y}$ lên không gian tuyến tính dựng trên các cột của $\XX .$
:::

:::{.remark}
Giả định $\XX$ là hằng số. Khi đó
tính ngẫu nhiên của
$\vec{Y}$
tuân theo tính ngẫu nhiên của
$\vec{\epsilon}.$
Để suy luận thống kê ta thường giả định thêm
$\XX$ là full rank; $\epsilon_1,\ldots\epsilon_n$ là **homoscedastic** (iid).
:::

## Homoscedastic model
:::{#exm-homoscedastic-gaussian}
### Homoscedastic gaussian
Giả định $\XX$ là hằng số, full rank,
$\epsilon_1,\ldots\epsilon_n\iid \Gaus{0,\sigma^2}.$
Khi đó

- LSE $\equiv$ MLE
- $\hat{\vec{\beta}}\sim\Gauk{p}{\vec{\beta}^*,\sigma^2(\XX^\tp\XX)^{-1}}.$
- MSE
$\E{\|\hat{\vec{\beta}}-\vec{\beta}^*\|_2^2} = \sigma^2\mathrm{tr}\left((\XX^\tp\XX)^{-1}\right).$
- Prediction error
$\E{\|\Y-\XX\hat{\vec{\beta}}\|_2^2} = \sigma^2(n-p).$
- Unbiased estimator of $\displaystyle \sigma^2:\quad \hat{\sigma}^2 = \frac{\E{\|\hat{\vec{\beta}}-\vec{\beta}^*\|_2^2}}{n-p}.$
:::
